{"ast":null,"code":"import _toConsumableArray from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import{Avatar,Button,Input,TextField}from\"@material-ui/core\";import{AspectRatio,Comment,Favorite,FavoriteBorder,OpenInNew,OpenWith}from\"@material-ui/icons\";import Skeleton from\"@material-ui/lab/Skeleton\";import React,{useState,useEffect,useContext}from\"react\";import Usercontext from\"../context/user\";import{findActiveUser,getAllPostComment,getAllPosts,getIndivisualPost,LikedPosts,profileUser}from\"../services/firebase\";import\"./post.css\";import firebase from\"firebase\";// import { findByLabelText } from \"@testing-library/dom\";\nimport InputEmoji from\"react-input-emoji\";import{db}from\"../firebase\";import{Link}from\"react-router-dom\";import{FacebookIcon,FacebookShareButton,LinkedinIcon,LinkedinShareButton,WhatsappIcon,WhatsappShareButton}from\"react-share\";import{makeStyles}from\"@material-ui/core/styles\";import Modal from\"@material-ui/core/Modal\";import PostPopup from\"./PostPopup\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function rand(){return Math.round(Math.random()*20)-10;}function getModalStyle(){var top=50;var left=50;return{top:\"\".concat(top,\"%\"),left:\"\".concat(left,\"%\"),transform:\"translate(-\".concat(top,\"%, -\").concat(left,\"%)\")};}var useStyles=makeStyles(function(theme){return{paper:_defineProperty({position:\"absolute\",width:\"80%\",height:\"90%\",backgroundColor:theme.palette.background.paper,border:\"2px solid #000\",boxShadow:theme.shadows[5],padding:theme.spacing(0,-5,2)},\"backgroundColor\",\" rgba(255,255,255,0.9)\")};});var uniqid=require(\"uniqid\");function Post(_ref){var postId=_ref.postId,uploaderId=_ref.uploaderId;var localUrl=window.location.href;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),post=_useState2[0],setPost=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),uploader=_useState4[0],setUploader=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),comment=_useState6[0],setComment=_useState6[1];var user=useContext(Usercontext);var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),thisPostComments=_useState8[0],setThisPostComments=_useState8[1];var classes=useStyles();var _React$useState=React.useState(getModalStyle),_React$useState2=_slicedToArray(_React$useState,1),modalStyle=_React$useState2[0];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),open=_React$useState4[0],setOpen=_React$useState4[1];var handleOpen=function handleOpen(){setOpen(true);};var handleClose=function handleClose(){setOpen(false);};var body=/*#__PURE__*/_jsx(\"div\",{style:modalStyle,className:classes.paper,children:/*#__PURE__*/_jsx(PostPopup,{post:post,postId:postId})});useEffect(function(){function getMyPost(){return _getMyPost.apply(this,arguments);}function _getMyPost(){_getMyPost=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,postComments,uploader;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getIndivisualPost(postId);case 2:response=_context.sent;_context.next=5;return getAllPostComment(postId);case 5:postComments=_context.sent;_context.next=8;return profileUser(uploaderId);case 8:uploader=_context.sent;setUploader(uploader);_context.next=12;return response.onSnapshot(function(snapshot){setPost(snapshot.data());});case 12:_context.next=14;return postComments.onSnapshot(function(snapshot){setThisPostComments(snapshot.docs.map(function(doc){return{id:doc.id,data:doc.data()};}));});case 14:case\"end\":return _context.stop();}}},_callee);}));return _getMyPost.apply(this,arguments);}if(postId&&uploaderId&&user){getMyPost();}},[postId]);var PostComment=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var comments;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:// e.preventDefault();\ncomments=[].concat(_toConsumableArray(thisPostComments),[{comment:comment,commentUser:user.user.username,timestamp:firebase.firestore.FieldValue.serverTimestamp(),commentUserUid:user.user.uid}]);_context2.next=3;return firebase.firestore().collection(\"photos\").doc(postId).collection(\"comments\").add({comment:comment,commentUser:user.user.displayName,timestamp:firebase.firestore.FieldValue.serverTimestamp(),commentUserUid:user.user.uid});case 3:setComment(\"\");case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function PostComment(_x){return _ref2.apply(this,arguments);};}();// console.log(postId, thisPostComments);\nvar Liked=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(t){var likeditem,index;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!t){_context3.next=8;break;}likeditem=post.liked;index=likeditem.indexOf(user.user.uid);if(index>-1){likeditem.splice(index,1);}_context3.next=6;return firebase.firestore().collection(\"photos\").doc(postId).update({liked:likeditem});case 6:_context3.next=10;break;case 8:_context3.next=10;return firebase.firestore().collection(\"photos\").doc(postId).update({liked:[].concat(_toConsumableArray(post.liked),[user.user.uid])});case 10:case\"end\":return _context3.stop();}}},_callee3);}));return function Liked(_x2){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"post\",children:[post?/*#__PURE__*/_jsxs(\"div\",{className:\"post__all\",children:[/*#__PURE__*/_jsx(Modal,{open:open,onClose:handleClose,\"aria-labelledby\":\"simple-modal-title\",\"aria-describedby\":\"simple-modal-description\",children:body}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",alignItems:\"center\",justifyContent:\"space-between\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"post_header\",children:[uploader?uploader[0].profile_photo?/*#__PURE__*/_jsx(Avatar,{className:\"post_avatar\",alt:\"Vishesh Kumar\",src:uploader[0].profile_photo}):/*#__PURE__*/_jsx(Avatar,{className:\"post_avatar\"}):/*#__PURE__*/_jsx(Avatar,{className:\"post_avatar\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Link,{to:\"/profile/\".concat(post.user_uid),style:{textDecoration:\"none\"},children:/*#__PURE__*/_jsx(\"h3\",{style:{marginRight:\"10px\"},children:post.username})}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:\"10px\"},children:post.timestamp.toDate().toDateString()})]})]}),/*#__PURE__*/_jsx(Link,{style:{marginRight:\"10px\"},to:\"/image/\".concat(postId),children:/*#__PURE__*/_jsx(OpenInNew,{})})]}),/*#__PURE__*/_jsxs(\"p\",{style:{marginLeft:\"10px\",marginBottom:\"10px\",fontSize:\"13px\"},children:[/*#__PURE__*/_jsx(\"b\",{children:\"Caption : \"}),post.caption,/*#__PURE__*/_jsx(\"b\",{children:post.caption===\"Update my Profile Pic at\"?\" \".concat(post.timestamp.toDate().toDateString()):null})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"post_header\",children:[/*#__PURE__*/_jsx(Skeleton,{variant:\"circle\",className:\"post_avatar\",width:40,height:40}),/*#__PURE__*/_jsx(Skeleton,{variant:\"text\",width:50,height:30})]}),post?/*#__PURE__*/_jsx(\"img\",{className:\"post_image\",src:post.fileUrl,alt:\"image of\"}):/*#__PURE__*/_jsx(Skeleton,{className:\"post_image\",variant:\"rect\",width:\"100%\",height:\"300px\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"post_bottom\",children:[post&&user.user&&thisPostComments?/*#__PURE__*/_jsxs(\"div\",{style:{padding:\"10px\",display:\"flex\",justifyContent:\"space-between\"},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"post__icon\",children:[post.liked.includes(user.user.uid)?/*#__PURE__*/_jsx(Favorite,{style:{cursor:\"pointer\",color:\"red\"},onClick:function onClick(){return Liked(true);}}):/*#__PURE__*/_jsx(FavoriteBorder,{style:{cursor:\"pointer\"},onClick:function onClick(){return Liked(false);}}),/*#__PURE__*/_jsx(Comment,{style:{marginLeft:\"10px\",cursor:\"pointer\",marginRight:\"10px\"}}),/*#__PURE__*/_jsx(AspectRatio,{onClick:handleOpen,style:{cursor:\"pointer\"}})]}),/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:\"12px\",color:\"gray\"},children:[post.liked.length,\" Likes \",thisPostComments.length,\" Comments\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(FacebookShareButton,{url:\"\".concat(localUrl,\"image/\").concat(postId)// quote={props.joke.setup + props.joke.punchline}\n,hashtag:\"#StupidProgrammer\",children:/*#__PURE__*/_jsx(FacebookIcon,{size:25,round:true})}),/*#__PURE__*/_jsx(WhatsappShareButton,{url:\"\".concat(localUrl,\"image/\").concat(postId)// quote={props.joke.setup + props.joke.punchline}\n,hashtag:\"#StupidProgrammer\",children:/*#__PURE__*/_jsx(WhatsappIcon,{size:25,round:true,style:{marginLeft:\"5px\",marginRight:\"5px\"}})}),/*#__PURE__*/_jsx(LinkedinShareButton,{url:\"\".concat(localUrl,\"image/\").concat(postId)// quote={props.joke.setup + props.joke.punchline}\n,hashtag:\"#StupidProgrammer\",children:/*#__PURE__*/_jsx(LinkedinIcon,{size:25,round:true})})]})]}):null,post&&thisPostComments?/*#__PURE__*/_jsx(\"div\",{className:\"post_comments\",children:thisPostComments.slice(0,5).map(function(_ref4){var id=_ref4.id,data=_ref4.data;return/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsxs(\"strong\",{children:[/*#__PURE__*/_jsxs(Link,{to:\"/profile/\".concat(data.commentUserUid),style:{textDecoration:\"none\"},children:[data.commentUser,\":\"]}),\" \"]}),/*#__PURE__*/_jsx(\"small\",{children:data.comment}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:\"10px\",color:\"gray\",position:\"relative\",left:\"2px\"},children:data.timestamp?data.timestamp.toDate().toDateString():null})]},id);})}):/*#__PURE__*/_jsx(Skeleton,{className:\"post_comments\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"post__comments__form\",style:{display:\"flex\"},children:[/*#__PURE__*/_jsx(InputEmoji,{placeholder:\"React on this image\",borderRadius:10,borderColor:\"white\",value:comment,onChange:setComment,cleanOnEnter:true,onEnter:PostComment,maxLength:200}),/*#__PURE__*/_jsx(Button,{type:\"submit\",onClick:PostComment,disabled:!postId||!user||comment.trim()===\"\",children:\"Post\"})]})]})]});}export default Post;","map":{"version":3,"sources":["G:/projects/photogram/src/components/Post.js"],"names":["Avatar","Button","Input","TextField","AspectRatio","Comment","Favorite","FavoriteBorder","OpenInNew","OpenWith","Skeleton","React","useState","useEffect","useContext","Usercontext","findActiveUser","getAllPostComment","getAllPosts","getIndivisualPost","LikedPosts","profileUser","firebase","InputEmoji","db","Link","FacebookIcon","FacebookShareButton","LinkedinIcon","LinkedinShareButton","WhatsappIcon","WhatsappShareButton","makeStyles","Modal","PostPopup","rand","Math","round","random","getModalStyle","top","left","transform","useStyles","theme","paper","position","width","height","backgroundColor","palette","background","border","boxShadow","shadows","padding","spacing","uniqid","require","Post","postId","uploaderId","localUrl","window","location","href","post","setPost","uploader","setUploader","comment","setComment","user","thisPostComments","setThisPostComments","classes","modalStyle","open","setOpen","handleOpen","handleClose","body","getMyPost","response","postComments","onSnapshot","snapshot","data","docs","map","doc","id","PostComment","e","comments","commentUser","username","timestamp","firestore","FieldValue","serverTimestamp","commentUserUid","uid","collection","add","displayName","Liked","t","likeditem","liked","index","indexOf","splice","update","display","alignItems","justifyContent","profile_photo","user_uid","textDecoration","marginRight","fontSize","toDate","toDateString","marginLeft","marginBottom","caption","fileUrl","includes","cursor","color","length","slice","trim"],"mappings":"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","sourcesContent":["import { Avatar, Button, Input, TextField } from \"@material-ui/core\";\r\nimport {\r\n  AspectRatio,\r\n  Comment,\r\n  Favorite,\r\n  FavoriteBorder,\r\n  OpenInNew,\r\n  OpenWith,\r\n} from \"@material-ui/icons\";\r\nimport Skeleton from \"@material-ui/lab/Skeleton\";\r\nimport React, { useState, useEffect, useContext } from \"react\";\r\nimport Usercontext from \"../context/user\";\r\nimport {\r\n  findActiveUser,\r\n  getAllPostComment,\r\n  getAllPosts,\r\n  getIndivisualPost,\r\n  LikedPosts,\r\n  profileUser,\r\n} from \"../services/firebase\";\r\nimport \"./post.css\";\r\nimport firebase from \"firebase\";\r\n// import { findByLabelText } from \"@testing-library/dom\";\r\nimport InputEmoji from \"react-input-emoji\";\r\nimport { db } from \"../firebase\";\r\nimport { Link } from \"react-router-dom\";\r\nimport {\r\n  FacebookIcon,\r\n  FacebookShareButton,\r\n  LinkedinIcon,\r\n  LinkedinShareButton,\r\n  WhatsappIcon,\r\n  WhatsappShareButton,\r\n} from \"react-share\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport Modal from \"@material-ui/core/Modal\";\r\nimport PostPopup from \"./PostPopup\";\r\n\r\nfunction rand() {\r\n  return Math.round(Math.random() * 20) - 10;\r\n}\r\n\r\nfunction getModalStyle() {\r\n  const top = 50;\r\n  const left = 50;\r\n\r\n  return {\r\n    top: `${top}%`,\r\n    left: `${left}%`,\r\n    transform: `translate(-${top}%, -${left}%)`,\r\n  };\r\n}\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  paper: {\r\n    position: \"absolute\",\r\n    width: \"80%\",\r\n    height: \"90%\",\r\n    backgroundColor: theme.palette.background.paper,\r\n    border: \"2px solid #000\",\r\n    boxShadow: theme.shadows[5],\r\n    padding: theme.spacing(0, -5, 2),\r\n    backgroundColor: \" rgba(255,255,255,0.9)\",\r\n  },\r\n}));\r\n\r\nconst uniqid = require(\"uniqid\");\r\n\r\nfunction Post({ postId, uploaderId }) {\r\n  const localUrl = window.location.href;\r\n\r\n  const [post, setPost] = useState(null);\r\n  const [uploader, setUploader] = useState(null);\r\n  const [comment, setComment] = useState(\"\");\r\n  const user = useContext(Usercontext);\r\n  const [thisPostComments, setThisPostComments] = useState([]);\r\n\r\n  const classes = useStyles();\r\n\r\n  const [modalStyle] = React.useState(getModalStyle);\r\n  const [open, setOpen] = React.useState(false);\r\n\r\n  const handleOpen = () => {\r\n    setOpen(true);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n\r\n  const body = (\r\n    <div style={modalStyle} className={classes.paper}>\r\n      <PostPopup post={post}  postId={postId} />\r\n    </div>\r\n  );\r\n\r\n  useEffect(() => {\r\n    async function getMyPost() {\r\n      // console.log(postId);\r\n      const response = await getIndivisualPost(postId);\r\n      const postComments = await getAllPostComment(postId);\r\n\r\n      const uploader = await profileUser(uploaderId);\r\n      setUploader(uploader);\r\n      await response.onSnapshot((snapshot) => {\r\n        setPost(snapshot.data());\r\n      });\r\n      await postComments.onSnapshot((snapshot) => {\r\n        setThisPostComments(\r\n          snapshot.docs.map((doc) => ({\r\n            id: doc.id,\r\n            data: doc.data(),\r\n          }))\r\n        );\r\n      });\r\n    }\r\n\r\n    if (postId && uploaderId && user) {\r\n      getMyPost();\r\n    }\r\n  }, [postId]);\r\n\r\n  const PostComment = async (e) => {\r\n    // e.preventDefault();\r\n    const comments = [\r\n      ...thisPostComments,\r\n      {\r\n        comment: comment,\r\n        commentUser: user.user.username,\r\n        timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n        commentUserUid: user.user.uid,\r\n      },\r\n    ];\r\n\r\n    await firebase\r\n      .firestore()\r\n      .collection(\"photos\")\r\n      .doc(postId)\r\n      .collection(\"comments\")\r\n      .add({\r\n        comment: comment,\r\n        commentUser: user.user.displayName,\r\n        timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n        commentUserUid: user.user.uid,\r\n      });\r\n\r\n    setComment(\"\");\r\n  };\r\n  // console.log(postId, thisPostComments);\r\n\r\n  const Liked = async (t) => {\r\n    if (t) {\r\n      const likeditem = post.liked;\r\n      var index = likeditem.indexOf(user.user.uid);\r\n      if (index > -1) {\r\n        likeditem.splice(index, 1);\r\n      }\r\n      await firebase.firestore().collection(\"photos\").doc(postId).update({\r\n        liked: likeditem,\r\n      });\r\n    } else {\r\n      await firebase\r\n        .firestore()\r\n        .collection(\"photos\")\r\n        .doc(postId)\r\n        .update({\r\n          liked: [...post.liked, user.user.uid],\r\n        });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"post\">\r\n      {post ? (\r\n        <div className=\"post__all\">\r\n          <Modal\r\n            open={open}\r\n            onClose={handleClose}\r\n            aria-labelledby=\"simple-modal-title\"\r\n            aria-describedby=\"simple-modal-description\"\r\n          >\r\n            {body}\r\n          </Modal>\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              alignItems: \"center\",\r\n              justifyContent: \"space-between\",\r\n            }}\r\n          >\r\n            <div className=\"post_header\">\r\n              {uploader ? (\r\n                uploader[0].profile_photo ? (\r\n                  <Avatar\r\n                    className=\"post_avatar\"\r\n                    alt=\"Vishesh Kumar\"\r\n                    src={uploader[0].profile_photo}\r\n                  />\r\n                ) : (\r\n                  <Avatar className=\"post_avatar\" />\r\n                )\r\n              ) : (\r\n                <Avatar className=\"post_avatar\" />\r\n              )}\r\n              <div>\r\n                <Link\r\n                  to={`/profile/${post.user_uid}`}\r\n                  style={{ textDecoration: \"none\" }}\r\n                >\r\n                  <h3 style={{ marginRight: \"10px\" }}>{post.username}</h3>\r\n                </Link>\r\n                <p style={{ fontSize: \"10px\" }}>\r\n                  {post.timestamp.toDate().toDateString()}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <Link style={{ marginRight: \"10px\" }} to={`/image/${postId}`}>\r\n              <OpenInNew />\r\n            </Link>\r\n          </div>\r\n          <p\r\n            style={{\r\n              marginLeft: \"10px\",\r\n              marginBottom: \"10px\",\r\n              fontSize: \"13px\",\r\n            }}\r\n          >\r\n            <b>Caption : </b>\r\n            {post.caption}\r\n            <b>\r\n              {post.caption === \"Update my Profile Pic at\"\r\n                ? ` ${post.timestamp.toDate().toDateString()}`\r\n                : null}\r\n            </b>\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"post_header\">\r\n          <Skeleton\r\n            variant=\"circle\"\r\n            className=\"post_avatar\"\r\n            width={40}\r\n            height={40}\r\n          />\r\n\r\n          <Skeleton variant=\"text\" width={50} height={30} />\r\n        </div>\r\n      )}\r\n      {post ? (\r\n        <img className=\"post_image\" src={post.fileUrl} alt=\"image of\" />\r\n      ) : (\r\n        <Skeleton\r\n          className=\"post_image\"\r\n          variant=\"rect\"\r\n          width=\"100%\"\r\n          height=\"300px\"\r\n        />\r\n      )}\r\n\r\n      <div className=\"post_bottom\">\r\n        {post && user.user && thisPostComments ? (\r\n          <div\r\n            style={{\r\n              padding: \"10px\",\r\n              display: \"flex\",\r\n              justifyContent: \"space-between\",\r\n            }}\r\n          >\r\n            <div>\r\n              <div className=\"post__icon\">\r\n                {post.liked.includes(user.user.uid) ? (\r\n                  <Favorite\r\n                    style={{ cursor: \"pointer\", color: \"red\" }}\r\n                    onClick={() => Liked(true)}\r\n                  />\r\n                ) : (\r\n                  <FavoriteBorder\r\n                    style={{ cursor: \"pointer\" }}\r\n                    onClick={() => Liked(false)}\r\n                  />\r\n                )}\r\n\r\n                <Comment\r\n                  style={{\r\n                    marginLeft: \"10px\",\r\n                    cursor: \"pointer\",\r\n                    marginRight: \"10px\",\r\n                  }}\r\n                />\r\n                <AspectRatio\r\n                  onClick={handleOpen}\r\n                  style={{ cursor: \"pointer\" }}\r\n                />\r\n              </div>\r\n              <p style={{ fontSize: \"12px\", color: \"gray\" }}>\r\n                {post.liked.length} Likes {thisPostComments.length} Comments\r\n              </p>\r\n            </div>\r\n            <div>\r\n              {/* share functionality */}\r\n              <FacebookShareButton\r\n                url={`${localUrl}image/${postId}`}\r\n                // quote={props.joke.setup + props.joke.punchline}\r\n                hashtag=\"#StupidProgrammer\"\r\n              >\r\n                <FacebookIcon size={25} round={true} />\r\n              </FacebookShareButton>\r\n              <WhatsappShareButton\r\n                url={`${localUrl}image/${postId}`}\r\n                // quote={props.joke.setup + props.joke.punchline}\r\n                hashtag=\"#StupidProgrammer\"\r\n              >\r\n                <WhatsappIcon\r\n                  size={25}\r\n                  round={true}\r\n                  style={{ marginLeft: \"5px\", marginRight: \"5px\" }}\r\n                />\r\n              </WhatsappShareButton>\r\n              <LinkedinShareButton\r\n                url={`${localUrl}image/${postId}`}\r\n                // quote={props.joke.setup + props.joke.punchline}\r\n                hashtag=\"#StupidProgrammer\"\r\n              >\r\n                <LinkedinIcon size={25} round={true} />\r\n              </LinkedinShareButton>\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n\r\n        {post && thisPostComments ? (\r\n          <div className=\"post_comments\">\r\n            {thisPostComments.slice(0, 5).map(({ id, data }) => (\r\n              <p key={id}>\r\n                <strong>\r\n                  <Link\r\n                    to={`/profile/${data.commentUserUid}`}\r\n                    style={{ textDecoration: \"none\" }}\r\n                  >\r\n                    {data.commentUser}:\r\n                  </Link>{\" \"}\r\n                </strong>\r\n                <small>{data.comment}</small>\r\n                <span\r\n                  style={{\r\n                    fontSize: \"10px\",\r\n                    color: \"gray\",\r\n                    position: \"relative\",\r\n                    left: \"2px\",\r\n                  }}\r\n                >\r\n                  {data.timestamp\r\n                    ? data.timestamp.toDate().toDateString()\r\n                    : null}\r\n                </span>\r\n              </p>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <Skeleton className=\"post_comments\" />\r\n        )}\r\n        <div className=\"post__comments__form\" style={{ display: \"flex\" }}>\r\n          {/* <form style={{ display: \"flex\" }} onSubmit={PostComment}> */}\r\n          {/* <input type=\"text\" style={{ width: \"100%\" }} /> */}\r\n          <InputEmoji\r\n            placeholder=\"React on this image\"\r\n            borderRadius={10}\r\n            borderColor=\"white\"\r\n            value={comment}\r\n            onChange={setComment}\r\n            cleanOnEnter\r\n            onEnter={PostComment}\r\n            maxLength={200}\r\n          />\r\n          <Button\r\n            type=\"submit\"\r\n            onClick={PostComment}\r\n            disabled={!postId || !user || comment.trim() === \"\"}\r\n          >\r\n            Post\r\n          </Button>\r\n          {/* </form> */}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Post;\r\n"]},"metadata":{},"sourceType":"module"}