{"ast":null,"code":"import _slicedToArray from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Button,Input}from\"@material-ui/core\";import React,{useState,useContext}from\"react\";import Usercontext from\"../context/user\";import{db,auth,storage}from\"../firebase\";import firebase from\"firebase\";import{SettingsPowerRounded}from\"@material-ui/icons\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function UpdatePic(_ref){var uid=_ref.uid,activeUser=_ref.activeUser,setOpen=_ref.setOpen,setShow=_ref.setShow;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),progress=_useState4[0],setProgress=_useState4[1];var _useState5=useState(\"this profile picture is updated at\"),_useState6=_slicedToArray(_useState5,2),caption=_useState6[0],setCaption=_useState6[1];var user=useContext(Usercontext);var changePic=function changePic(e){e.preventDefault();// console.log(\"hello i am working\");\nvar uploadTask=storage.ref(\"profilePic/\".concat(file.name)).put(file);uploadTask.on(\"state_changed\",function(snapshot){var progress=Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);setProgress(progress);},function(error){// console.log(error.message);\nalert(error.message);},function(){storage.ref(\"profilePic\").child(file.name).getDownloadURL().then(function(url){db.collection(\"users\").doc(activeUser.docId).update({profile_photo:url,profilePicUpdatedAt:firebase.firestore.FieldValue.serverTimestamp()});db.collection(\"photos\").add({timestamp:firebase.firestore.FieldValue.serverTimestamp(),caption:caption,username:user.user.displayName,user_uid:uid,fileUrl:url,liked:[]});//  setCaption(\"\");\nsetFile(null);setProgress(0);setOpen(false);setShow(\"myPosts\");});});};var FileHandleChange=function FileHandleChange(e){if(e.target.files[0]){setFile(e.target.files[0]);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"updatePic\",children:[progress?/*#__PURE__*/_jsx(\"progress\",{id:\"file\",value:progress,max:\"100\",style:{width:\"100%\"}}):null,/*#__PURE__*/_jsxs(\"form\",{onSubmit:changePic,children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:FileHandleChange,accept:\".png, .jpg, .jpeg, .gif\"// value={file}\n,style:{marginTop:\"10px\",marginBottom:\"10px\"}}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:!file&&!activeUser,children:\"upload\"})]})]});}export default UpdatePic;","map":{"version":3,"sources":["G:/projects/photogram/src/components/UpdatePic.js"],"names":["Button","Input","React","useState","useContext","Usercontext","db","auth","storage","firebase","SettingsPowerRounded","UpdatePic","uid","activeUser","setOpen","setShow","file","setFile","progress","setProgress","caption","setCaption","user","changePic","e","preventDefault","uploadTask","ref","name","put","on","snapshot","Math","round","bytesTransferred","totalBytes","error","alert","message","child","getDownloadURL","then","url","collection","doc","docId","update","profile_photo","profilePicUpdatedAt","firestore","FieldValue","serverTimestamp","add","timestamp","username","displayName","user_uid","fileUrl","liked","FileHandleChange","target","files","width","marginTop","marginBottom"],"mappings":"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","sourcesContent":["import { Button, Input } from \"@material-ui/core\";\r\nimport React, { useState, useContext } from \"react\";\r\nimport Usercontext from \"../context/user\";\r\nimport { db, auth, storage } from \"../firebase\";\r\nimport firebase from \"firebase\";\r\nimport { SettingsPowerRounded } from \"@material-ui/icons\";\r\n\r\nfunction UpdatePic({ uid, activeUser, setOpen, setShow }) {\r\n  const [file, setFile] = useState(null);\r\n  const [progress, setProgress] = useState(0);\r\n  const [caption, setCaption] = useState(\"this profile picture is updated at\");\r\n  const user = useContext(Usercontext);\r\n \r\n\r\n  const changePic = (e) => {\r\n    e.preventDefault();\r\n\r\n    // console.log(\"hello i am working\");\r\n    const uploadTask = storage.ref(`profilePic/${file.name}`).put(file);\r\n    uploadTask.on(\r\n      \"state_changed\",\r\n      (snapshot) => {\r\n        const progress = Math.round(\r\n          (snapshot.bytesTransferred / snapshot.totalBytes) * 100\r\n        );\r\n        setProgress(progress);\r\n      },\r\n      (error) => {\r\n        // console.log(error.message);\r\n        alert(error.message);\r\n      },\r\n      () => {\r\n        storage\r\n          .ref(\"profilePic\")\r\n          .child(file.name)\r\n          .getDownloadURL()\r\n          .then((url) => {\r\n            db.collection(\"users\").doc(activeUser.docId).update({\r\n              profile_photo: url,\r\n              profilePicUpdatedAt:\r\n                firebase.firestore.FieldValue.serverTimestamp(),\r\n            });\r\n            db.collection(\"photos\").add({\r\n              timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n              caption: caption,\r\n              username: user.user.displayName,\r\n              user_uid: uid,\r\n              fileUrl: url,\r\n              liked: [],\r\n              \r\n            });\r\n            //  setCaption(\"\");\r\n            setFile(null);\r\n            setProgress(0);\r\n            setOpen(false);\r\n            setShow(\"myPosts\");\r\n\r\n          });\r\n      }\r\n    );\r\n  };\r\n\r\n  const FileHandleChange = (e) => {\r\n    if (e.target.files[0]) {\r\n      setFile(e.target.files[0]);\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"updatePic\">\r\n      {progress ? (\r\n        <progress\r\n          id=\"file\"\r\n          value={progress}\r\n          max=\"100\"\r\n          style={{ width: \"100%\" }}\r\n        />\r\n      ) : null}\r\n      <form onSubmit={changePic}>\r\n        <input\r\n          type=\"file\"\r\n          onChange={FileHandleChange}\r\n          accept=\".png, .jpg, .jpeg, .gif\"\r\n          // value={file}\r\n          style={{ marginTop: \"10px\", marginBottom: \"10px\" }}\r\n        />\r\n        <Button type=\"submit\" disabled={!file && !activeUser}>\r\n          upload\r\n        </Button>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default UpdatePic;\r\n"]},"metadata":{},"sourceType":"module"}