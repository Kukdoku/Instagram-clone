{"ast":null,"code":"import _slicedToArray from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Button,Input}from\"@material-ui/core\";import React,{useState,useContext}from\"react\";import upload from\"../images/upload.gif\";import\"./uploadPost.css\";import{storage,db}from\"../firebase\";import firebase from\"firebase\";import Usercontext from\"../context/user\";import{Route,useHistory}from\"react-router-dom\";import*as ROUTES from\"../constants/routes\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function UploadPost(_ref){var profile_uid=_ref.profile_uid,setShow=_ref.setShow,user_uid=_ref.user_uid;var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),progress=_useState4[0],setProgress=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),caption=_useState6[0],setCaption=_useState6[1];var user=useContext(Usercontext);// console.log(user.user.displayName);\nvar UploadPost=function UploadPost(e){e.preventDefault();// console.log(file);\n// console.log(caption);\nvar uploadTask=storage.ref(\"images/\".concat(file.name)).put(file);uploadTask.on(\"state_changed\",function(snapshot){var progress=Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);setProgress(progress);},function(error){// console.log(error.message);\nalert(error.message);},function(){storage.ref(\"images\").child(file.name).getDownloadURL().then(function(url){db.collection(\"photos\").add({timestamp:firebase.firestore.FieldValue.serverTimestamp(),caption:caption,username:user.user.displayName,user_uid:user_uid,fileUrl:url,liked:[]});setCaption(\"\");setFile(null);setProgress(0);setShow(\"myPosts\");// history.push(`/profile/${uid}`);\n// window.location.reload();\n});});};var FileHandleChange=function FileHandleChange(e){if(e.target.files[0]){setFile(e.target.files[0]);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"uploadPost\",children:[progress?/*#__PURE__*/_jsx(\"progress\",{id:\"file\",value:progress,max:\"100\",style:{width:\"100%\"}}):null,/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\"},children:[/*#__PURE__*/_jsx(\"img\",{src:upload,alt:\"profile Picture\",style:{width:\"200px\"}}),user.user.uid===profile_uid?/*#__PURE__*/_jsxs(\"form\",{className:\"upload__form\",onSubmit:UploadPost,children:[/*#__PURE__*/_jsx(Input,{type:\"text\",onChange:function onChange(e){return setCaption(e.target.value);},value:caption,placeholder:\"Give Caption For Image\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:FileHandleChange,accept:\".png, .jpg, .jpeg, .gif\"// value={file}\n,style:{marginTop:\"10px\",marginBottom:\"10pxf\"}}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:!file,children:\"Upload Image\"})]}):/*#__PURE__*/_jsx(\"h3\",{children:\"You can not post at this profile\"})]})]});}export default UploadPost;","map":{"version":3,"sources":["G:/projects/photogram/src/components/UploadPost.js"],"names":["Button","Input","React","useState","useContext","upload","storage","db","firebase","Usercontext","Route","useHistory","ROUTES","UploadPost","profile_uid","setShow","user_uid","history","file","setFile","progress","setProgress","caption","setCaption","user","e","preventDefault","uploadTask","ref","name","put","on","snapshot","Math","round","bytesTransferred","totalBytes","error","alert","message","child","getDownloadURL","then","url","collection","add","timestamp","firestore","FieldValue","serverTimestamp","username","displayName","fileUrl","liked","FileHandleChange","target","files","width","display","uid","value","marginTop","marginBottom"],"mappings":"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","sourcesContent":["import { Button, Input } from \"@material-ui/core\";\r\nimport React, { useState, useContext } from \"react\";\r\nimport upload from \"../images/upload.gif\";\r\nimport \"./uploadPost.css\";\r\nimport { storage, db } from \"../firebase\";\r\nimport firebase from \"firebase\";\r\nimport Usercontext from \"../context/user\";\r\nimport { Route, useHistory } from \"react-router-dom\";\r\nimport * as ROUTES from \"../constants/routes\";\r\n\r\nfunction UploadPost({ profile_uid, setShow, user_uid }) {\r\n  const history = useHistory();\r\n  const [file, setFile] = useState(null);\r\n  const [progress, setProgress] = useState(0);\r\n  const [caption, setCaption] = useState(\"\");\r\n  const user = useContext(Usercontext);\r\n  // console.log(user.user.displayName);\r\n\r\n  const UploadPost = (e) => {\r\n    e.preventDefault();\r\n    // console.log(file);\r\n    // console.log(caption);\r\n    const uploadTask = storage.ref(`images/${file.name}`).put(file);\r\n    uploadTask.on(\r\n      \"state_changed\",\r\n      (snapshot) => {\r\n        const progress = Math.round(\r\n          (snapshot.bytesTransferred / snapshot.totalBytes) * 100\r\n        );\r\n        setProgress(progress);\r\n      },\r\n      (error) => {\r\n        // console.log(error.message);\r\n        alert(error.message);\r\n      },\r\n      () => {\r\n        storage\r\n          .ref(\"images\")\r\n          .child(file.name)\r\n          .getDownloadURL()\r\n          .then((url) => {\r\n            db.collection(\"photos\").add({\r\n              timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n              caption: caption,\r\n              username: user.user.displayName,\r\n              user_uid: user_uid,\r\n              fileUrl: url,\r\n              liked: [],\r\n              \r\n            });\r\n            setCaption(\"\");\r\n            setFile(null);\r\n            setProgress(0);\r\n            setShow(\"myPosts\");\r\n\r\n            // history.push(`/profile/${uid}`);\r\n            // window.location.reload();\r\n          });\r\n      }\r\n    );\r\n  };\r\n\r\n  const FileHandleChange = (e) => {\r\n    if (e.target.files[0]) {\r\n      setFile(e.target.files[0]);\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"uploadPost\">\r\n      {progress ? (\r\n        <progress\r\n          id=\"file\"\r\n          value={progress}\r\n          max=\"100\"\r\n          style={{ width: \"100%\" }}\r\n        />\r\n      ) : null}\r\n\r\n      <div style={{ display: \"flex\" }}>\r\n        <img src={upload} alt=\"profile Picture\" style={{ width: \"200px\" }} />\r\n        {user.user.uid === profile_uid ? (\r\n          <form className=\"upload__form\" onSubmit={UploadPost}>\r\n            <Input\r\n              type=\"text\"\r\n              onChange={(e) => setCaption(e.target.value)}\r\n              value={caption}\r\n              placeholder=\"Give Caption For Image\"\r\n            />\r\n            <input\r\n              type=\"file\"\r\n              onChange={FileHandleChange}\r\n              accept=\".png, .jpg, .jpeg, .gif\"\r\n              // value={file}\r\n              style={{ marginTop: \"10px\", marginBottom: \"10pxf\" }}\r\n            />\r\n            <Button type=\"submit\" disabled={!file}>\r\n              Upload Image\r\n            </Button>\r\n          </form>\r\n        ) : (\r\n          <h3>You can not post at this profile</h3>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default UploadPost;\r\n"]},"metadata":{},"sourceType":"module"}