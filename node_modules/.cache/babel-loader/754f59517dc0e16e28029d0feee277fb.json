{"ast":null,"code":"import _slicedToArray from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Button,Input}from\"@material-ui/core\";import React,{useState,useContext}from\"react\";import upload from\"../images/upload.gif\";import\"./uploadPost.css\";import{storage,db}from\"../firebase\";import firebase from\"firebase\";import Usercontext from\"../context/user\";import{Route,useHistory}from\"react-router-dom\";import*as ROUTES from\"../constants/routes\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function UploadPost(_ref){var profile_uid=_ref.profile_uid,setShow=_ref.setShow,user_uid=_ref.user_uid;var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),progress=_useState4[0],setProgress=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),caption=_useState6[0],setCaption=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var user=useContext(Usercontext);// console.log(user.user.displayName);\nvar UploadPost=function UploadPost(e){e.preventDefault();// console.log(file);\n// console.log(caption);\nvar fileType=file.type.split(\"/\")[0];console.log(file);if(file.size>10485760){setError(\"file size must be less then 10 mb\");}else{var uploadTask=storage.ref(\"\".concat(fileType,\"/\").concat(file.name)).put(file);uploadTask.on(\"state_changed\",function(snapshot){var progress=Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);setProgress(progress);},function(error){// console.log(error.message);\nalert(error.message);},function(){storage.ref(\"\".concat(fileType)).child(file.name).getDownloadURL().then(function(url){db.collection(\"photos\").add({timestamp:firebase.firestore.FieldValue.serverTimestamp(),caption:caption,username:user.user.displayName,user_uid:user_uid,fileUrl:url,liked:[],type:fileType});setCaption(\"\");setFile(null);setProgress(0);setShow(\"myPosts\");// history.push(`/profile/${uid}`);\n// window.location.reload();\n});});}};var FileHandleChange=function FileHandleChange(e){if(e.target.files[0]){setFile(e.target.files[0]);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"uploadPost\",children:[progress?/*#__PURE__*/_jsx(\"progress\",{id:\"file\",value:progress,max:\"100\",style:{width:\"100%\"}}):null,/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\"},children:[/*#__PURE__*/_jsx(\"img\",{src:upload,alt:\"profile Picture\",style:{width:\"200px\"}}),user.user.uid===profile_uid?/*#__PURE__*/_jsxs(\"form\",{className:\"upload__form\",onSubmit:UploadPost,children:[/*#__PURE__*/_jsx(Input,{type:\"text\",onChange:function onChange(e){return setCaption(e.target.value);},value:caption,placeholder:\"Give Caption For Image\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:FileHandleChange,accept:\".png, .jpg, .jpeg, .gif,.mov,.mp4\"// value={file}\n,style:{marginTop:\"10px\",marginBottom:\"10pxf\"}}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:!file,variant:\"contained\",style:{marginTop:\"10px\",marginBottom:\"10px\"},children:\"Upload Image\"}),error?/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\",fontSize:\"15px\"},children:error}):null]}):/*#__PURE__*/_jsx(\"h3\",{children:\"You can not post at this profile\"})]})]});}export default UploadPost;","map":{"version":3,"sources":["G:/projects/photogram/src/components/UploadPost.js"],"names":["Button","Input","React","useState","useContext","upload","storage","db","firebase","Usercontext","Route","useHistory","ROUTES","UploadPost","profile_uid","setShow","user_uid","history","file","setFile","progress","setProgress","caption","setCaption","error","setError","user","e","preventDefault","fileType","type","split","console","log","size","uploadTask","ref","name","put","on","snapshot","Math","round","bytesTransferred","totalBytes","alert","message","child","getDownloadURL","then","url","collection","add","timestamp","firestore","FieldValue","serverTimestamp","username","displayName","fileUrl","liked","FileHandleChange","target","files","width","display","uid","value","marginTop","marginBottom","color","fontSize"],"mappings":"4IAAA,OAASA,MAAT,CAAiBC,KAAjB,KAA8B,mBAA9B,CACA,MAAOC,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,UAA1B,KAA4C,OAA5C,CACA,MAAOC,CAAAA,MAAP,KAAmB,sBAAnB,CACA,MAAO,kBAAP,CACA,OAASC,OAAT,CAAkBC,EAAlB,KAA4B,aAA5B,CACA,MAAOC,CAAAA,QAAP,KAAqB,UAArB,CACA,MAAOC,CAAAA,WAAP,KAAwB,iBAAxB,CACA,OAASC,KAAT,CAAgBC,UAAhB,KAAkC,kBAAlC,CACA,MAAO,GAAKC,CAAAA,MAAZ,KAAwB,qBAAxB,C,wFAEA,QAASC,CAAAA,UAAT,MAAwD,IAAlCC,CAAAA,WAAkC,MAAlCA,WAAkC,CAArBC,OAAqB,MAArBA,OAAqB,CAAZC,QAAY,MAAZA,QAAY,CACtD,GAAMC,CAAAA,OAAO,CAAGN,UAAU,EAA1B,CACA,cAAwBR,QAAQ,CAAC,IAAD,CAAhC,wCAAOe,IAAP,eAAaC,OAAb,eACA,eAAgChB,QAAQ,CAAC,CAAD,CAAxC,yCAAOiB,QAAP,eAAiBC,WAAjB,eACA,eAA8BlB,QAAQ,CAAC,EAAD,CAAtC,yCAAOmB,OAAP,eAAgBC,UAAhB,eACA,eAA0BpB,QAAQ,CAAC,EAAD,CAAlC,yCAAOqB,KAAP,eAAcC,QAAd,eACA,GAAMC,CAAAA,IAAI,CAAGtB,UAAU,CAACK,WAAD,CAAvB,CAEA;AAEA,GAAMI,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACc,CAAD,CAAO,CACxBA,CAAC,CAACC,cAAF,GACA;AACA;AACA,GAAIC,CAAAA,QAAQ,CAAGX,IAAI,CAACY,IAAL,CAAUC,KAAV,CAAgB,GAAhB,EAAqB,CAArB,CAAf,CAEAC,OAAO,CAACC,GAAR,CAAYf,IAAZ,EACA,GAAIA,IAAI,CAACgB,IAAL,CAAY,QAAhB,CAA0B,CACxBT,QAAQ,CAAC,mCAAD,CAAR,CACD,CAFD,IAEO,CACL,GAAMU,CAAAA,UAAU,CAAG7B,OAAO,CAAC8B,GAAR,WAAeP,QAAf,aAA2BX,IAAI,CAACmB,IAAhC,GAAwCC,GAAxC,CAA4CpB,IAA5C,CAAnB,CAEAiB,UAAU,CAACI,EAAX,CACE,eADF,CAEE,SAACC,QAAD,CAAc,CACZ,GAAMpB,CAAAA,QAAQ,CAAGqB,IAAI,CAACC,KAAL,CACdF,QAAQ,CAACG,gBAAT,CAA4BH,QAAQ,CAACI,UAAtC,CAAoD,GADrC,CAAjB,CAGAvB,WAAW,CAACD,QAAD,CAAX,CACD,CAPH,CAQE,SAACI,KAAD,CAAW,CACT;AACAqB,KAAK,CAACrB,KAAK,CAACsB,OAAP,CAAL,CACD,CAXH,CAYE,UAAM,CACJxC,OAAO,CACJ8B,GADH,WACUP,QADV,GAEGkB,KAFH,CAES7B,IAAI,CAACmB,IAFd,EAGGW,cAHH,GAIGC,IAJH,CAIQ,SAACC,GAAD,CAAS,CACb3C,EAAE,CAAC4C,UAAH,CAAc,QAAd,EAAwBC,GAAxB,CAA4B,CAC1BC,SAAS,CAAE7C,QAAQ,CAAC8C,SAAT,CAAmBC,UAAnB,CAA8BC,eAA9B,EADe,CAE1BlC,OAAO,CAAEA,OAFiB,CAG1BmC,QAAQ,CAAE/B,IAAI,CAACA,IAAL,CAAUgC,WAHM,CAI1B1C,QAAQ,CAAEA,QAJgB,CAK1B2C,OAAO,CAAET,GALiB,CAM1BU,KAAK,CAAE,EANmB,CAO1B9B,IAAI,CAAED,QAPoB,CAA5B,EASAN,UAAU,CAAC,EAAD,CAAV,CACAJ,OAAO,CAAC,IAAD,CAAP,CACAE,WAAW,CAAC,CAAD,CAAX,CACAN,OAAO,CAAC,SAAD,CAAP,CAGA;AACA;AACD,CAtBH,EAuBD,CApCH,EAsCD,CACF,CAnDD,CAqDA,GAAM8C,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAAClC,CAAD,CAAO,CAC9B,GAAIA,CAAC,CAACmC,MAAF,CAASC,KAAT,CAAe,CAAf,CAAJ,CAAuB,CACrB5C,OAAO,CAACQ,CAAC,CAACmC,MAAF,CAASC,KAAT,CAAe,CAAf,CAAD,CAAP,CACD,CACF,CAJD,CAKA,mBACE,aAAK,SAAS,CAAC,YAAf,WACG3C,QAAQ,cACP,iBACE,EAAE,CAAC,MADL,CAEE,KAAK,CAAEA,QAFT,CAGE,GAAG,CAAC,KAHN,CAIE,KAAK,CAAE,CAAE4C,KAAK,CAAE,MAAT,CAJT,EADO,CAOL,IARN,cAUE,aAAK,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAX,CAAZ,wBACE,YAAK,GAAG,CAAE5D,MAAV,CAAkB,GAAG,CAAC,iBAAtB,CAAwC,KAAK,CAAE,CAAE2D,KAAK,CAAE,OAAT,CAA/C,EADF,CAEGtC,IAAI,CAACA,IAAL,CAAUwC,GAAV,GAAkBpD,WAAlB,cACC,cAAM,SAAS,CAAC,cAAhB,CAA+B,QAAQ,CAAED,UAAzC,wBACE,KAAC,KAAD,EACE,IAAI,CAAC,MADP,CAEE,QAAQ,CAAE,kBAACc,CAAD,QAAOJ,CAAAA,UAAU,CAACI,CAAC,CAACmC,MAAF,CAASK,KAAV,CAAjB,EAFZ,CAGE,KAAK,CAAE7C,OAHT,CAIE,WAAW,CAAC,wBAJd,EADF,cAOE,cACE,IAAI,CAAC,MADP,CAEE,QAAQ,CAAEuC,gBAFZ,CAGE,MAAM,CAAC,mCACP;AAJF,CAKE,KAAK,CAAE,CAAEO,SAAS,CAAE,MAAb,CAAqBC,YAAY,CAAE,OAAnC,CALT,EAPF,cAcE,KAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,QAAQ,CAAE,CAACnD,IAFb,CAGE,OAAO,CAAC,WAHV,CAIE,KAAK,CAAE,CAAEkD,SAAS,CAAE,MAAb,CAAqBC,YAAY,CAAE,MAAnC,CAJT,0BAdF,CAsBG7C,KAAK,cACJ,UAAG,KAAK,CAAE,CAAE8C,KAAK,CAAE,KAAT,CAAgBC,QAAQ,CAAE,MAA1B,CAAV,UAA+C/C,KAA/C,EADI,CAEF,IAxBN,GADD,cA4BC,wDA9BJ,GAVF,GADF,CA8CD,CAED,cAAeX,CAAAA,UAAf","sourcesContent":["import { Button, Input } from \"@material-ui/core\";\r\nimport React, { useState, useContext } from \"react\";\r\nimport upload from \"../images/upload.gif\";\r\nimport \"./uploadPost.css\";\r\nimport { storage, db } from \"../firebase\";\r\nimport firebase from \"firebase\";\r\nimport Usercontext from \"../context/user\";\r\nimport { Route, useHistory } from \"react-router-dom\";\r\nimport * as ROUTES from \"../constants/routes\";\r\n\r\nfunction UploadPost({ profile_uid, setShow, user_uid }) {\r\n  const history = useHistory();\r\n  const [file, setFile] = useState(null);\r\n  const [progress, setProgress] = useState(0);\r\n  const [caption, setCaption] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const user = useContext(Usercontext);\r\n\r\n  // console.log(user.user.displayName);\r\n\r\n  const UploadPost = (e) => {\r\n    e.preventDefault();\r\n    // console.log(file);\r\n    // console.log(caption);\r\n    let fileType = file.type.split(\"/\")[0];\r\n\r\n    console.log(file);\r\n    if (file.size > 10485760) {\r\n      setError(\"file size must be less then 10 mb\");\r\n    } else {\r\n      const uploadTask = storage.ref(`${fileType}/${file.name}`).put(file);\r\n\r\n      uploadTask.on(\r\n        \"state_changed\",\r\n        (snapshot) => {\r\n          const progress = Math.round(\r\n            (snapshot.bytesTransferred / snapshot.totalBytes) * 100\r\n          );\r\n          setProgress(progress);\r\n        },\r\n        (error) => {\r\n          // console.log(error.message);\r\n          alert(error.message);\r\n        },\r\n        () => {\r\n          storage\r\n            .ref(`${fileType}`)\r\n            .child(file.name)\r\n            .getDownloadURL()\r\n            .then((url) => {\r\n              db.collection(\"photos\").add({\r\n                timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n                caption: caption,\r\n                username: user.user.displayName,\r\n                user_uid: user_uid,\r\n                fileUrl: url,\r\n                liked: [],\r\n                type: fileType,\r\n              });\r\n              setCaption(\"\");\r\n              setFile(null);\r\n              setProgress(0);\r\n              setShow(\"myPosts\");\r\n              \r\n\r\n              // history.push(`/profile/${uid}`);\r\n              // window.location.reload();\r\n            });\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  const FileHandleChange = (e) => {\r\n    if (e.target.files[0]) {\r\n      setFile(e.target.files[0]);\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"uploadPost\">\r\n      {progress ? (\r\n        <progress\r\n          id=\"file\"\r\n          value={progress}\r\n          max=\"100\"\r\n          style={{ width: \"100%\" }}\r\n        />\r\n      ) : null}\r\n\r\n      <div style={{ display: \"flex\" }}>\r\n        <img src={upload} alt=\"profile Picture\" style={{ width: \"200px\" }} />\r\n        {user.user.uid === profile_uid ? (\r\n          <form className=\"upload__form\" onSubmit={UploadPost}>\r\n            <Input\r\n              type=\"text\"\r\n              onChange={(e) => setCaption(e.target.value)}\r\n              value={caption}\r\n              placeholder=\"Give Caption For Image\"\r\n            />\r\n            <input\r\n              type=\"file\"\r\n              onChange={FileHandleChange}\r\n              accept=\".png, .jpg, .jpeg, .gif,.mov,.mp4\"\r\n              // value={file}\r\n              style={{ marginTop: \"10px\", marginBottom: \"10pxf\" }}\r\n            />\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={!file}\r\n              variant=\"contained\"\r\n              style={{ marginTop: \"10px\", marginBottom: \"10px\" }}\r\n            >\r\n              Upload Image\r\n            </Button>\r\n            {error ? (\r\n              <p style={{ color: \"red\", fontSize: \"15px\" }}>{error}</p>\r\n            ) : null}\r\n          </form>\r\n        ) : (\r\n          <h3>You can not post at this profile</h3>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default UploadPost;\r\n"]},"metadata":{},"sourceType":"module"}