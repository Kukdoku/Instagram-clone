{"ast":null,"code":"import _toConsumableArray from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"G:/projects/photogram/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Avatar,Button,Input}from\"@material-ui/core\";import{CameraAlt,Create}from\"@material-ui/icons\";import React,{useState,useContext,useEffect}from\"react\";import{Link}from\"react-router-dom\";import LikedPost from\"../components/LikedPost\";import MyPost from\"../components/MyPost\";import UploadPost from\"../components/UploadPost\";import Usercontext from\"../context/user\";import\"./profile.css\";import{makeStyles}from\"@material-ui/core/styles\";import Modal from\"@material-ui/core/Modal\";import Follower from\"../components/Follower\";import Following from\"../components/Following\";import UpdatePic from\"../components/UpdatePic\";// import { profileUser } from \"../services/firebase\";\nimport{doesUsernameExist,findActiveUser,profileUser,updateFollowedUserFollowers,updateLoggedInUserFollowing}from\"../services/firebase\";import firebase from\"firebase\";import download from\"../images/download.png\";// import Skeleton from \"react-loading-skeleton\";\nimport Skeleton from\"@material-ui/lab/Skeleton\";import{db,auth,storage}from\"../firebase\";import FollowButton from\"../components/FollowButton\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function getModalStyle(){var top=50;var left=50;return{top:\"\".concat(top,\"%\"),left:\"\".concat(left,\"%\"),transform:\"translate(-\".concat(top,\"%, -\").concat(left,\"%)\")};}var useStyles=makeStyles(function(theme){return{paper:{position:\"absolute\",width:\"50%\",height:\"80%\",backgroundColor:theme.palette.background.paper,// border: \"2px solid #000\",\nborderRadius:\"20px\",// boxShadow: theme.shadows[5],\npadding:theme.spacing(2,0,3)}};});function Profile(){var user_uid=window.location.href.split(\"/profile/\")[1];// const [changeUserName, setChangeUserName] = useState('')\nvar user=useContext(Usercontext);var _useState=useState(\"myPosts\"),_useState2=_slicedToArray(_useState,2),show=_useState2[0],setShow=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),captionForm=_useState4[0],setcaptionForm=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),popup=_useState6[0],setPopup=_useState6[1];var classes=useStyles();var _React$useState=React.useState(getModalStyle),_React$useState2=_slicedToArray(_React$useState,1),modalStyle=_React$useState2[0];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),open=_React$useState4[0],setOpen=_React$useState4[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),profileUser=_useState8[0],setProfileUser=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),activeUser=_useState10[0],setActiveUser=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),status=_useState12[0],setStatus=_useState12[1];var _useState13=useState(\"counting\"),_useState14=_slicedToArray(_useState13,2),myPostNo=_useState14[0],setMyPostNo=_useState14[1];var comp;var handleOpen=function handleOpen(item){setOpen(true);setPopup(item);};var handleClose=function handleClose(){setOpen(false);setPopup(\"\");};if(show===\"myPosts\"){comp=/*#__PURE__*/_jsx(MyPost,{uid:user_uid,setMyPostNo:setMyPostNo});}else if(show===\"myUpload\"){comp=/*#__PURE__*/_jsx(UploadPost,{profile_uid:user_uid,user_uid:user.user.uid,setShow:setShow});}else if(show===\"liked\"){comp=/*#__PURE__*/_jsx(LikedPost,{uid:user_uid});}var body;if(popup===\"follower\"){body=/*#__PURE__*/_jsx(\"div\",{style:modalStyle,className:classes.paper,children:profileUser[0]?/*#__PURE__*/_jsx(Follower,{uid:user_uid,follower:profileUser[0].follower,setOpen:setOpen}):null});}else if(popup===\"following\"){body=/*#__PURE__*/_jsx(\"div\",{style:modalStyle,className:classes.paper,children:profileUser[0]?/*#__PURE__*/_jsx(Following,{uid:user_uid,following:profileUser[0].following,setOpen:setOpen}):null});}else if(popup===\"updatePic\"){body=/*#__PURE__*/_jsx(\"div\",{style:modalStyle,className:classes.paper,children:user_uid!==null&&activeUser!==null?/*#__PURE__*/_jsx(UpdatePic,{uid:user_uid,activeUser:activeUser[0],setOpen:setOpen,setShow:setShow}):/*#__PURE__*/_jsx(Skeleton,{variant:\"text\",width:30,height:20})});}useEffect(function(){function getTimelinePhotos(){return _getTimelinePhotos.apply(this,arguments);}function _getTimelinePhotos(){_getTimelinePhotos=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return findActiveUser(user.user.uid);case 2:result=_context.sent;setActiveUser(result);_context.next=6;return firebase.firestore().collection(\"users\").where(\"userId\",\"==\",user_uid).onSnapshot(function(snapshot){setProfileUser(snapshot.docs.map(function(doc){return _objectSpread(_objectSpread({},doc.data()),{},{docId:doc.id});}));});case 6:case\"end\":return _context.stop();}}},_callee);}));return _getTimelinePhotos.apply(this,arguments);}if(user_uid!==\"\"&&user){getTimelinePhotos();}},[user_uid]);var HandleFollow=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(isfollow){var following,index,follower,_following,_follower;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!isfollow){_context2.next=13;break;}following=activeUser[0].following;index=following.indexOf(profileUser[0].userId);if(index>-1){following.splice(index,1);}follower=profileUser[0].follower;index=follower.indexOf(activeUser[0].userId);if(index>-1){follower.splice(index,1);}_context2.next=9;return firebase.firestore().collection(\"users\").doc(activeUser[0].docId).update({following:following});case 9:_context2.next=11;return firebase.firestore().collection(\"users\").doc(profileUser[0].docId).update({follower:follower});case 11:_context2.next=19;break;case 13:_following=[].concat(_toConsumableArray(activeUser[0].following),[profileUser[0].userId]);_follower=[].concat(_toConsumableArray(profileUser[0].follower),[activeUser[0].userId]);_context2.next=17;return firebase.firestore().collection(\"users\").doc(activeUser[0].docId).update({following:_following});case 17:_context2.next=19;return firebase.firestore().collection(\"users\").doc(profileUser[0].docId).update({follower:_follower});case 19:case\"end\":return _context2.stop();}}},_callee2);}));return function HandleFollow(_x){return _ref.apply(this,arguments);};}();var UpdateStatus=function UpdateStatus(e){e.preventDefault();db.collection(\"users\").doc(activeUser[0].docId).update({status:status});setcaptionForm(false);};if(activeUser){// console.log(\"active\", activeUser[0].data);\n}return/*#__PURE__*/_jsxs(\"div\",{className:\"profile\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile__top\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"profile__left\",children:profileUser===null?/*#__PURE__*/_jsx(Skeleton,{variant:\"circle\",width:100,height:100,className:\"profile__pic\"}):/*#__PURE__*/_jsx(\"img\",{src:!profileUser[0].profile_photo?\"\".concat(download):profileUser[0].profile_photo,alt:\"profilePic\",className:\"profile__pic\"})}),/*#__PURE__*/_jsx(Modal,{open:open,onClose:handleClose,\"aria-labelledby\":\"simple-modal-title\",\"aria-describedby\":\"simple-modal-description\",children:body}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile__right\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",alignItems:\"center\"},children:[profileUser?/*#__PURE__*/_jsx(\"h3\",{children:profileUser[0].username}):/*#__PURE__*/_jsx(\"p\",{children:\"loading..\"}),user&&profileUser?user_uid===user.user.uid?/*#__PURE__*/_jsx(CameraAlt,{style:{marginLeft:\"20px\",marginRight:\"20px\",cursor:\"pointer\"},onClick:function onClick(){return handleOpen(\"updatePic\");}}):profileUser[0].follower.includes(user.user.uid)?/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return HandleFollow(true);},className:\"followButton\",style:{backgroundColor:\"#6edb8b\"},children:\"Following\"}):/*#__PURE__*/_jsx(\"button\",{variant:\"outlined\",className:\"followButton\",onClick:function onClick(){return HandleFollow(false);},style:{backgroundColor:\"#db51a4\"},children:\"Follow\"}):null,/*#__PURE__*/_jsxs(Button,{variant:\"outlined\",children:[\" \",/*#__PURE__*/_jsx(Link,{to:\"/chat/\".concat(user_uid),style:{textDecoration:\"none\"},children:\"message\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile__information\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"profile__info\",onClick:function onClick(){return setShow(\"myPosts\");},children:[myPostNo,\" posts\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"profile__info\",style:{marginLeft:\"20px\",marginRight:\"20px\"},onClick:function onClick(){return handleOpen(\"follower\");},children:[profileUser?profileUser[0].follower.length:\"...\",\" follower\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"profile__info\",onClick:function onClick(){return handleOpen(\"following\");},children:[\" \",profileUser?profileUser[0].following.length:\"...\",\" following\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"profile__caption\",children:captionForm&&user.user.uid==user_uid?/*#__PURE__*/_jsxs(\"form\",{style:{display:\"flex\",alignItems:\"center\",marginTop:\"20px\"},onSubmit:UpdateStatus,children:[/*#__PURE__*/_jsx(\"b\",{children:\"Status : \"}),/*#__PURE__*/_jsx(Input,{placeholder:\"set Status\",value:status,onChange:function onChange(e){return setStatus(e.target.value);}}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:!status||!activeUser,children:\"Done\"}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return setcaptionForm(false);},children:\"Back\"})]}):/*#__PURE__*/_jsxs(\"p\",{style:{display:\"flex\",alignItems:\"center\",marginTop:\"20px\"},children:[/*#__PURE__*/_jsx(\"b\",{children:\"Status : \"}),\" \",profileUser?profileUser[0].status:/*#__PURE__*/_jsx(Skeleton,{varient:\"text\",width:50,height:30}),\" \",/*#__PURE__*/_jsx(\"span\",{style:{cursor:\"pointer\"},children:/*#__PURE__*/_jsx(Create,{onClick:function onClick(){return setcaptionForm(true);}})})]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"profile__button\",children:[/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return setShow(\"myPosts\");},children:\"All Posts\"}),/*#__PURE__*/_jsx(Button,{style:{marginLeft:\"20wh\",marginRight:\"20wh\"},onClick:function onClick(){return setShow(\"myUpload\");},children:\"CreatePosts\"}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return setShow(\"liked\");},children:\"liked\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"profile__content\",children:comp})]});}export default Profile;","map":{"version":3,"sources":["G:/projects/photogram/src/pages/Profile.js"],"names":["Avatar","Button","Input","CameraAlt","Create","React","useState","useContext","useEffect","Link","LikedPost","MyPost","UploadPost","Usercontext","makeStyles","Modal","Follower","Following","UpdatePic","doesUsernameExist","findActiveUser","profileUser","updateFollowedUserFollowers","updateLoggedInUserFollowing","firebase","download","Skeleton","db","auth","storage","FollowButton","getModalStyle","top","left","transform","useStyles","theme","paper","position","width","height","backgroundColor","palette","background","borderRadius","padding","spacing","Profile","user_uid","window","location","href","split","user","show","setShow","captionForm","setcaptionForm","popup","setPopup","classes","modalStyle","open","setOpen","setProfileUser","activeUser","setActiveUser","status","setStatus","myPostNo","setMyPostNo","comp","handleOpen","item","handleClose","uid","body","follower","following","getTimelinePhotos","result","firestore","collection","where","onSnapshot","snapshot","docs","map","doc","data","docId","id","HandleFollow","isfollow","index","indexOf","userId","splice","update","UpdateStatus","e","preventDefault","profile_photo","display","alignItems","username","marginLeft","marginRight","cursor","includes","textDecoration","length","marginTop","target","value"],"mappings":"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","sourcesContent":["import { Avatar, Button, Input } from \"@material-ui/core\";\r\nimport { CameraAlt, Create } from \"@material-ui/icons\";\r\nimport React, { useState, useContext, useEffect } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport LikedPost from \"../components/LikedPost\";\r\nimport MyPost from \"../components/MyPost\";\r\nimport UploadPost from \"../components/UploadPost\";\r\nimport Usercontext from \"../context/user\";\r\n\r\nimport \"./profile.css\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport Modal from \"@material-ui/core/Modal\";\r\nimport Follower from \"../components/Follower\";\r\nimport Following from \"../components/Following\";\r\nimport UpdatePic from \"../components/UpdatePic\";\r\n// import { profileUser } from \"../services/firebase\";\r\nimport {\r\n  doesUsernameExist,\r\n  findActiveUser,\r\n  profileUser,\r\n  updateFollowedUserFollowers,\r\n  updateLoggedInUserFollowing,\r\n} from \"../services/firebase\";\r\nimport firebase from \"firebase\";\r\nimport download from \"../images/download.png\";\r\n// import Skeleton from \"react-loading-skeleton\";\r\nimport Skeleton from \"@material-ui/lab/Skeleton\";\r\nimport { db, auth, storage } from \"../firebase\";\r\nimport FollowButton from \"../components/FollowButton\";\r\n\r\nfunction getModalStyle() {\r\n  const top = 50;\r\n  const left = 50;\r\n\r\n  return {\r\n    top: `${top}%`,\r\n    left: `${left}%`,\r\n    transform: `translate(-${top}%, -${left}%)`,\r\n  };\r\n}\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  paper: {\r\n    position: \"absolute\",\r\n    width: \"50%\",\r\n    height: \"80%\",\r\n\r\n    backgroundColor: theme.palette.background.paper,\r\n    // border: \"2px solid #000\",\r\n    borderRadius: \"20px\",\r\n    // boxShadow: theme.shadows[5],\r\n    padding: theme.spacing(2, 0, 3),\r\n  },\r\n}));\r\n\r\nfunction Profile() {\r\n  const user_uid = window.location.href.split(\"/profile/\")[1];\r\n  // const [changeUserName, setChangeUserName] = useState('')\r\n  const user = useContext(Usercontext);\r\n  const [show, setShow] = useState(\"myPosts\");\r\n  const [captionForm, setcaptionForm] = useState(false);\r\n\r\n  const [popup, setPopup] = useState(\"\");\r\n\r\n  const classes = useStyles();\r\n\r\n  const [modalStyle] = React.useState(getModalStyle);\r\n  const [open, setOpen] = React.useState(false);\r\n  const [profileUser, setProfileUser] = useState(null);\r\n  const [activeUser, setActiveUser] = useState(null);\r\n  const [status, setStatus] = useState(\"\");\r\n  const [myPostNo, setMyPostNo] = useState(\"counting\");\r\n\r\n  let comp;\r\n\r\n  const handleOpen = (item) => {\r\n    setOpen(true);\r\n    setPopup(item);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n    setPopup(\"\");\r\n  };\r\n\r\n  if (show === \"myPosts\") {\r\n    comp = <MyPost uid={user_uid} setMyPostNo={setMyPostNo} />;\r\n  } else if (show === \"myUpload\") {\r\n    comp = (\r\n      <UploadPost\r\n        profile_uid={user_uid}\r\n        user_uid={user.user.uid}\r\n        setShow={setShow}\r\n      />\r\n    );\r\n  } else if (show === \"liked\") {\r\n    comp = <LikedPost uid={user_uid} />;\r\n  }\r\n\r\n  let body;\r\n\r\n  if (popup === \"follower\") {\r\n    body = (\r\n      <div style={modalStyle} className={classes.paper}>\r\n        {profileUser[0] ? (\r\n          <Follower\r\n            uid={user_uid}\r\n            follower={profileUser[0].follower}\r\n            setOpen={setOpen}\r\n          />\r\n        ) : null}\r\n      </div>\r\n    );\r\n  } else if (popup === \"following\") {\r\n    body = (\r\n      <div style={modalStyle} className={classes.paper}>\r\n        {profileUser[0] ? (\r\n          <Following\r\n            uid={user_uid}\r\n            following={profileUser[0].following}\r\n            setOpen={setOpen}\r\n          />\r\n        ) : null}\r\n      </div>\r\n    );\r\n  } else if (popup === \"updatePic\") {\r\n    body = (\r\n      <div style={modalStyle} className={classes.paper}>\r\n        {user_uid !== null && activeUser !== null ? (\r\n          <UpdatePic\r\n            uid={user_uid}\r\n            activeUser={activeUser[0]}\r\n            setOpen={setOpen}\r\n            setShow={setShow}\r\n          />\r\n        ) : (\r\n          <Skeleton variant=\"text\" width={30} height={20} />\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  useEffect(() => {\r\n    async function getTimelinePhotos() {\r\n      const result = await findActiveUser(user.user.uid);\r\n      setActiveUser(result);\r\n\r\n      await firebase\r\n        .firestore()\r\n        .collection(\"users\")\r\n        .where(\"userId\", \"==\", user_uid)\r\n        .onSnapshot((snapshot) => {\r\n          setProfileUser(\r\n            snapshot.docs.map((doc) => ({\r\n              ...doc.data(),\r\n              docId: doc.id,\r\n            }))\r\n          );\r\n        });\r\n    }\r\n    if (user_uid !== \"\" && user) {\r\n      getTimelinePhotos();\r\n    }\r\n  }, [user_uid]);\r\n\r\n  const HandleFollow = async (isfollow) => {\r\n    if (isfollow) {\r\n      let following = activeUser[0].following;\r\n      var index = following.indexOf(profileUser[0].userId);\r\n      if (index > -1) {\r\n        following.splice(index, 1);\r\n      }\r\n      let follower = profileUser[0].follower;\r\n      var index = follower.indexOf(activeUser[0].userId);\r\n      if (index > -1) {\r\n        follower.splice(index, 1);\r\n      }\r\n      await firebase\r\n        .firestore()\r\n        .collection(\"users\")\r\n        .doc(activeUser[0].docId)\r\n        .update({\r\n          following: following,\r\n        });\r\n      await firebase\r\n        .firestore()\r\n        .collection(\"users\")\r\n        .doc(profileUser[0].docId)\r\n        .update({\r\n          follower: follower,\r\n        });\r\n    } else {\r\n      let following = [...activeUser[0].following, profileUser[0].userId];\r\n      let follower = [...profileUser[0].follower, activeUser[0].userId];\r\n      await firebase\r\n        .firestore()\r\n        .collection(\"users\")\r\n        .doc(activeUser[0].docId)\r\n        .update({\r\n          following: following,\r\n        });\r\n      await firebase\r\n        .firestore()\r\n        .collection(\"users\")\r\n        .doc(profileUser[0].docId)\r\n        .update({\r\n          follower: follower,\r\n        });\r\n    }\r\n    \r\n  };\r\n\r\n  const UpdateStatus = (e) => {\r\n    e.preventDefault();\r\n    db.collection(\"users\").doc(activeUser[0].docId).update({\r\n      status: status,\r\n    });\r\n    setcaptionForm(false);\r\n  };\r\n  if (activeUser) {\r\n    // console.log(\"active\", activeUser[0].data);\r\n  }\r\n\r\n  return (\r\n    <div className=\"profile\">\r\n      <div className=\"profile__top\">\r\n        <div className=\"profile__left\">\r\n          {profileUser === null ? (\r\n            <Skeleton\r\n              variant=\"circle\"\r\n              width={100}\r\n              height={100}\r\n              className=\"profile__pic\"\r\n            />\r\n          ) : (\r\n            <img\r\n              src={\r\n                !profileUser[0].profile_photo\r\n                  ? `${download}`\r\n                  : profileUser[0].profile_photo\r\n              }\r\n              alt=\"profilePic\"\r\n              className=\"profile__pic\"\r\n            />\r\n          )}\r\n        </div>\r\n        <Modal\r\n          open={open}\r\n          onClose={handleClose}\r\n          aria-labelledby=\"simple-modal-title\"\r\n          aria-describedby=\"simple-modal-description\"\r\n        >\r\n          {body}\r\n        </Modal>\r\n        <div className=\"profile__right\">\r\n          <div style={{ display: \"flex\", alignItems: \"center\" }}>\r\n            {profileUser ? (\r\n              <h3>{profileUser[0].username}</h3>\r\n            ) : (\r\n              <p>loading..</p>\r\n            )}\r\n            {user && profileUser ? (\r\n              user_uid === user.user.uid ? (\r\n                <CameraAlt\r\n                  style={{\r\n                    marginLeft: \"20px\",\r\n                    marginRight: \"20px\",\r\n                    cursor: \"pointer\",\r\n                  }}\r\n                  onClick={() => handleOpen(\"updatePic\")}\r\n                />\r\n              ) : profileUser[0].follower.includes(user.user.uid) ? (\r\n                <button\r\n                  onClick={() => HandleFollow(true)}\r\n                  className=\"followButton\"\r\n                  style={{ backgroundColor: \"#6edb8b\" }}\r\n                >\r\n                  Following\r\n                </button>\r\n              ) : (\r\n                <button\r\n                  variant=\"outlined\"\r\n                  className=\"followButton\"\r\n                  onClick={() => HandleFollow(false)}\r\n                  style={{ backgroundColor: \"#db51a4\" }}\r\n                >\r\n                  Follow\r\n                </button>\r\n              )\r\n            ) : null}\r\n\r\n            <Button variant=\"outlined\">\r\n              {\" \"}\r\n              <Link to={`/chat/${user_uid}`} style={{ textDecoration: \"none\" }}>\r\n                message\r\n              </Link>\r\n            </Button>\r\n          </div>\r\n\r\n          <div className=\"profile__information\">\r\n            <p className=\"profile__info\" onClick={() => setShow(\"myPosts\")}>\r\n              {myPostNo} posts\r\n            </p>\r\n            <p\r\n              className=\"profile__info\"\r\n              style={{ marginLeft: \"20px\", marginRight: \"20px\" }}\r\n              onClick={() => handleOpen(\"follower\")}\r\n            >\r\n              {profileUser ? profileUser[0].follower.length : \"...\"} follower\r\n            </p>\r\n            <p\r\n              className=\"profile__info\"\r\n              onClick={() => handleOpen(\"following\")}\r\n            >\r\n              {\" \"}\r\n              {profileUser ? profileUser[0].following.length : \"...\"} following\r\n            </p>\r\n          </div>\r\n          <div className=\"profile__caption\">\r\n            {captionForm && user.user.uid == user_uid ? (\r\n              <form\r\n                style={{\r\n                  display: \"flex\",\r\n                  alignItems: \"center\",\r\n                  marginTop: \"20px\",\r\n                }}\r\n                onSubmit={UpdateStatus}\r\n              >\r\n                <b>Status : </b>\r\n                <Input\r\n                  placeholder=\"set Status\"\r\n                  value={status}\r\n                  onChange={(e) => setStatus(e.target.value)}\r\n                />\r\n                <Button type=\"submit\" disabled={!status || !activeUser}>\r\n                  Done\r\n                </Button>\r\n                <Button onClick={() => setcaptionForm(false)}>Back</Button>\r\n              </form>\r\n            ) : (\r\n              <p\r\n                style={{\r\n                  display: \"flex\",\r\n                  alignItems: \"center\",\r\n                  marginTop: \"20px\",\r\n                }}\r\n              >\r\n                <b>Status : </b>{\" \"}\r\n                {profileUser ? (\r\n                  profileUser[0].status\r\n                ) : (\r\n                  <Skeleton varient=\"text\" width={50} height={30} />\r\n                )}{\" \"}\r\n                <span style={{ cursor: \"pointer\" }}>\r\n                  <Create onClick={() => setcaptionForm(true)} />\r\n                </span>\r\n              </p>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"profile__button\">\r\n        <Button onClick={() => setShow(\"myPosts\")}>All Posts</Button>\r\n\r\n        <Button\r\n          style={{ marginLeft: \"20wh\", marginRight: \"20wh\" }}\r\n          onClick={() => setShow(\"myUpload\")}\r\n        >\r\n          CreatePosts\r\n        </Button>\r\n\r\n        <Button onClick={() => setShow(\"liked\")}>liked</Button>\r\n      </div>\r\n\r\n      <div className=\"profile__content\">{comp}</div>\r\n      {/* profile icon */}\r\n      {/* profile details */}\r\n      {/* follower button */}\r\n      {/* my all posts, upload post, liked posts  */}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Profile;\r\n"]},"metadata":{},"sourceType":"module"}